<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>网站图标提取工具</title>
    <style>
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-family: 'Segoe UI', system-ui;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        #urlInput {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            font-size: 1rem;
        }

        #fetchBtn {
            padding: 0.8rem 1.5rem;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #fetchBtn:hover {
            background: #357abd;
            transform: translateY(-1px);
        }

        .result-panel {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .icon-card {
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.2s;
        }

        .icon-card:hover {
            transform: translateY(-3px);
        }

        .icon-img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 0.5rem;
        }

        .status-text {
            padding: 1rem;
            text-align: center;
            color: #666;
        }

        .error-box {
            color: #dc3545;
            background: #ffecec;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #2c3e50; margin-bottom: 1.5rem;">🔍 网站图标提取工具</h1>
        
        <div class="search-box">
            <input type="url" id="urlInput" placeholder="输入域名或URL (例: google.com)">
            <button id="fetchBtn">提取图标</button>
        </div>

        <div id="status" class="status-text"></div>
        <div id="errorBox" class="error-box" style="display: none;"></div>

        <div class="result-panel" id="resultPanel" style="display: none;">
            <h3 style="margin: 0 0 1rem;">找到以下图标资源</h3>
            <div class="icon-grid" id="iconGrid"></div>
        </div>
    </div>

<script>
const FAVICON_API = 'https://favicon.zhusl.com/ico?url=';

// 域名验证正则
const DOMAIN_REGEX = /^(https?:\/\/)?([\w-]+\.)+[\w-]+(\/.*)?$/;

async function fetchIcons(url) {
    try {
        showLoading('正在搜索图标...');
        hideError();
        
        // 标准化输入
        const cleanUrl = normalizeUrl(url);
        if (!validateDomain(cleanUrl)) {
            throw new Error('无效的域名格式');
        }

        // 主API请求
        const apiUrl = `${FAVICON_API}${encodeURIComponent(cleanUrl)}`;
        const response = await fetch(apiUrl);
        
        if (!response.ok) throw new Error(`API请求失败: ${response.status}`);
        
        const data = await response.json();
        if (!data || !data.icons || data.icons.length === 0) {
            throw new Error('未找到图标资源');
        }

        displayResults(data.icons);
        
    } catch (error) {
        showError(`获取失败: ${error.message}`);
        console.error('Error:', error);
    } finally {
        hideLoading();
    }
}

function normalizeUrl(input) {
    // 移除协议头和路径
    return input.replace(/^(https?:\/\/)?/i, '')
                .split('/')[0]
                .toLowerCase();
}

function validateDomain(domain) {
    return DOMAIN_REGEX.test(domain);
}

function displayResults(icons) {
    const grid = document.getElementById('iconGrid');
    grid.innerHTML = '';
    
    icons.forEach(icon => {
        if (!icon.src) return;
        
        const card = document.createElement('div');
        card.className = 'icon-card';
        card.innerHTML = `
            <img src="${icon.src}" class="icon-img" alt="网站图标">
            <div style="font-size: 0.9em;">
                <a href="${icon.src}" target="_blank" 
                   style="word-break: break-all;">
                   ${new URL(icon.src).pathname.split('/').pop()}
                </a>
                ${icon.size ? `<div>${icon.size}px</div>` : ''}
            </div>
        `;
        grid.appendChild(card);
    });
    
    document.getElementById('resultPanel').style.display = 'block';
}

// 状态控制函数
function showLoading(text) {
    document.getElementById('status').textContent = text;
}

function hideLoading() {
    document.getElementById('status').textContent = '';
}

function showError(msg) {
    const errorBox = document.getElementById('errorBox');
    errorBox.style.display = 'block';
    errorBox.textContent = msg;
}

function hideError() {
    document.getElementById('errorBox').style.display = 'none';
}

// 事件绑定
document.getElementById('fetchBtn').addEventListener('click', () => {
    const input = document.getElementById('urlInput').value.trim();
    if (!input) return showError('请输入要查询的域名');
    
    document.getElementById('resultPanel').style.display = 'none';
    fetchIcons(input);
});

document.getElementById('urlInput').addEventListener('keypress', e => {
    if (e.key === 'Enter') document.getElementById('fetchBtn').click();
});
</script>
</body>
</html>