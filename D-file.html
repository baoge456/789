<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D-File</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.1.3/axios.min.js"></script>
    <script src="https://unpkg.com/js-base64"></script>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAMxJREFUOE+t06FuAkEQxvH/FxpegUoeovXUoOobJLapRDaw2T1b21qwoNGUB8BW45jwDmQJENIj3F2vd0wyZjL7m2QmK2qGar7nCLSGsadIF2hfgOLTvGZFQ47A/Xt0iFFG45jI5Kp+x9acfg71v4Dc4YKHTdDqDHSAQ2ZFzKkvLdH3LyDegGYqixcsvHkt0sDiXxcRz+Y1rw7AiwVN6wB9CxpXB8SreX1VByIDS/RRBxhaonACXGyzYwo8lrzEmgZP5rS+zWcqOTWzbQ96PEURUT++WAAAAABJRU5ErkJggg==" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { padding: 20px 0 10px; background: #000; color: #fff; }
        body { font-size: 16px; max-width: 80%; margin: auto; }
        h2 { margin-bottom: 10px; }
        .back { display: inline-block; border: 1px solid #ff9000; padding: 4px 12px; font-size: 15px; cursor: pointer; margin-left: 20px; background: #ff9000; color: #000; border-radius: 3px; transition: all 0.2s; }
        .back:hover { background: #000; color: #ff9000; }
        input.back, input[type="text"] { background: #1b1b1b; border: 1px solid #333; color: #fff; padding: 6px; width: calc(100% - 12px); margin-top: 10px; }
        .file_list li { line-height: 40px; border-bottom: 1px solid #333; display: flex; align-items: center; padding: 6px 0; }
        .file_list li a { color: #fff; text-decoration: none; flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file_list li.dir a { text-decoration: underline; color: #ff9000; font-weight: bold; }
        @media screen and (max-width: 700px) {
            body { max-width: 95%; padding: 0 10px; }
            .back.ftr { display: none; }
            .file_list li { width: 100%; }
            h2 { font-size: 16px; }
            .back { padding: 2px 8px; font-size: 13px; margin-left: 10px; }
        }
    </style>
</head>
<body>
    <div id="drop-zone" style="min-height: calc(100vh - 200px); position: relative;" ondrop="handleDrop(event)" ondragover="handleDragOver(event)">
        <div class="drag-hint">💡 支持拖拽上传：直接将文件拖放到页面任意位置即可上传</div>
        <p>开发者：宝哥 <span class="tip">测试延迟请在根目录上传<b>init.jpg</b>(50kb以内)</span></p>
        <h4>根域名：<input type="text" value="" id="rootdm" /></h4>
        <input type="file" id="file" class="filepond" name="filepond" />
        <h2>当前目录：<i id="repo"></i>
            <span onclick="addDir()" class="back">新建目录</span>
            <span onclick="document.getElementById('file').click()" class="back">上传文件</span>
            <span onclick="dirBack()" class="back">←返回</span>
            <span onclick="refresh()" class="back ftr">刷新</span>
            <input type="text" class="back ftr" id="search" placeholder="关键词搜索, 回车确认" onkeyup="search(event)" />
        </h2>
        <div id="file_wrap">
            <ul class="file_list" id="file_list">加载中...</ul>
        </div>
    </div>

    <script>
        window.baseRepo = localStorage.getItem("GIT_REPO") || "dhjz/file";
        window.baseToken = localStorage.getItem("GIT_TOKEN") || "";
        
        function toggleWrap() {
            var wrap = document.getElementById("file_wrap");
            wrap.className = wrap.className ? "" : "w50";
        }

        function initFileList(searchVal) {
            let rootdm = document.getElementById("rootdm").value || "";
            let tempList = window.fileList;
            if (searchVal && searchVal.trim()) {
                tempList = window.fileList.filter(item => item.name.includes(searchVal.trim()));
            }

            document.getElementById("file_list").innerHTML = tempList.length ? 
                tempList.map(item => `<li class="${item.ftype}"><a target="_blank" href="${rootdm}${encodeURIComponent(item.path)}">${item.name}</a><span class='size'>${getUnit(item.size)}</span></li>`).join("") : 
                `<div class='empty-folder-hint'><i>📁</i><p>当前文件夹为空</p></div>`;
            
            document.getElementById("repo").innerHTML = baseRepo + "/" + (paths.length ? paths[paths.length - 1] : "");
        }

        // Additional functions like getDir, addDir, dirBack, refresh, search would be defined here...

    </script>
</body>
</html>
