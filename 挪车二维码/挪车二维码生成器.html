<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>快点挪车二维码生成器</title>
  <link href="https://js.653827.xyz/https%3A%2F%2Fbaoge6789.github.io%2Fewm%2Fbootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f5f6fa; margin: 0; }
    .error { color: red; }
    .github-corner { display: none; }
    .center-box { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
    .panda-box { position: relative; width: 340px; margin-bottom: -40px; z-index: 2; }
    .login-container { position: relative; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px #0002; padding: 40px 28px 28px 28px; width: 340px; z-index: 1; margin-top: -40px; }
    .login-title { text-align: center; font-size: 1.5em; color: #333; margin-bottom: 28px; letter-spacing: 2px; }
    .form-group { margin-bottom: 18px; }
    label { display: block; margin-bottom: 6px; color: #555; font-size: 1em; }
    input[type="text"], input[type="password"] { width: 100%; padding: 8px 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 1em; background: #fafbfc; transition: border 0.2s; }
    input[type="text"]:focus, input[type="password"]:focus { border-color: #1976d2; outline: none; }
    .login-btn { width: 100%; padding: 10px 0; background: #1976d2; color: #fff; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer; margin-top: 10px; transition: background 0.2s; }
    .login-btn:hover { background: #1256a3; }
    .login-footer { text-align: center; color: #aaa; font-size: 0.95em; margin-top: 18px; }
    @media (max-width: 500px) { .panda-box, .login-container { width: 96vw; min-width: 0; max-width: 98vw; } }
  </style>
</head>
<body>
  <!-- 登录页面 -->
  <div id="loginPage" style="display: block;">
    <div class="center-box">
      <div class="panda-box">
        <!-- 熊猫SVG -->
        <svg width="340" height="180" viewBox="0 0 340 180" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="70" cy="60" rx="36" ry="28" fill="#222"/>
          <ellipse cx="270" cy="60" rx="36" ry="28" fill="#222"/>
          <ellipse cx="170" cy="100" rx="100" ry="80" fill="#fff" stroke="#222" stroke-width="4"/>
          <ellipse cx="120" cy="110" rx="22" ry="16" fill="#222"/>
          <ellipse cx="220" cy="110" rx="22" ry="16" fill="#222"/>
          <ellipse cx="120" cy="115" rx="7" ry="7" fill="#fff"/>
          <ellipse cx="220" cy="115" rx="7" ry="7" fill="#fff"/>
          <ellipse cx="120" cy="117" rx="3" ry="3" fill="#222"/>
          <ellipse cx="220" cy="117" rx="3" ry="3" fill="#222"/>
          <ellipse cx="170" cy="135" rx="10" ry="7" fill="#222"/>
          <path d="M160 145 Q170 155 180 145" stroke="#222" stroke-width="3" fill="none"/>
          <ellipse cx="90" cy="170" rx="28" ry="18" fill="#222"/>
          <ellipse cx="90" cy="170" rx="12" ry="8" fill="#fff"/>
          <ellipse cx="250" cy="170" rx="28" ry="18" fill="#222"/>
          <ellipse cx="250" cy="170" rx="12" ry="8" fill="#fff"/>
          <ellipse cx="110" cy="160" rx="16" ry="10" fill="#222"/>
          <ellipse cx="230" cy="160" rx="16" ry="10" fill="#222"/>
        </svg>
      </div>
      <div class="login-container">
        <div class="login-title">登录</div>
        <form id="loginForm">
          <div class="form-group">
            <label for="username">用户名</label>
            <input type="text" id="username" name="username" autocomplete="username" required>
          </div>
          <div class="form-group">
            <label for="password">密码</label>
            <input type="password" id="password" name="password" autocomplete="current-password" required>
          </div>
          <button type="submit" class="login-btn">登录</button>
          <div id="loginError" class="error"></div>
        </form>
        <div class="login-footer">
          &copy; 2025 挪车二维码生成系统
        </div>
      </div>
    </div>
  </div>

  <!-- 主页面 -->
  <div id="mainPage" style="display: none;">
    <div class="container">
      <h1 class="mt-5">快点挪车二维码生成器</h1>
      <form id="inputForm" class="mt-4">
        <div class="mb-3">
          <label for="plateNumber" class="form-label">车牌号:</label>
          <input type="text" class="form-control" id="plateNumber" name="plateNumber" required placeholder="京A88888">
          <div id="plateNumberError" class="error"></div>
        </div>
        <div class="mb-3">
          <label for="phoneNumber" class="form-label">手机号:</label>
          <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required placeholder="13888888888">
          <div id="phoneNumberError" class="error"></div>
        </div>
        <button type="submit" class="btn btn-primary">生成二维码</button>
        <button id="downloadButton" class="btn btn-success" style="display: none;" type="button">下载图片</button>
        <a id="previewLink" class="btn btn-info" href="" style="display: none;" target="_blank">车辆信息预览</a>
      </form>
      <div class="card mt-4" id="cardContent" style="width: 18rem;">
        <div class="card-body">
          <h5 class="card-title">临时停靠，请多关照</h5>
          <h6 class="card-subtitle mb-2 text-muted">手机扫码，呼叫挪车</h6>
          <div id="qrcode" class="text-center"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 登录逻辑
    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();
      var username = document.getElementById('username').value.trim();
      var password = document.getElementById('password').value.trim();
      var loginError = document.getElementById('loginError');
      if (username !== 'baoge' || password !== 'wsb123456') {
        loginError.textContent = '用户名或密码错误！';
        return;
      }
      loginError.textContent = '';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('mainPage').style.display = 'block';
    });

    // 绑定二维码生成逻辑
    document.getElementById('inputForm').addEventListener('submit', function(event) {
      event.preventDefault();
      var plateNumber = document.getElementById('plateNumber').value.trim();
      var phoneNumber = document.getElementById('phoneNumber').value.trim();
      var plateNumberError = document.getElementById('plateNumberError');
      var phoneNumberError = document.getElementById('phoneNumberError');
      var plateNumberRegex = /^([京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[a-zA-Z](([DF]((?![IO])[a-zA-Z0-9](?![IO]))[0-9]{4})|([0-9]{5}[DF]))|[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1})$/;
      var phoneNumberRegex = /^1\d{10}$/; // 修正此处
      if (!plateNumberRegex.test(plateNumber)) {
          plateNumberError.textContent = '请输入正确的车牌号';
          return;
      } else {
          plateNumberError.textContent = '';
      }
      if (!phoneNumberRegex.test(phoneNumber)) {
          phoneNumberError.textContent = '请输入正确的手机号';
          return;
      } else {
          phoneNumberError.textContent = '';
      }
      var url = 'https://dfile.baoge.wang/movecarinfo.html/?plateNumber=' + encodeURIComponent(plateNumber) + '&phoneNumber=' + encodeURIComponent(phoneNumber);
      var link = document.getElementById("previewLink");
      link.href = url;
      link.style.display = 'inline';
      var qrCodeDiv = document.getElementById('qrcode');
      qrCodeDiv.innerHTML = "";
      new QRCode(qrCodeDiv, {
          text: url,
          width: 200,
          height: 200,
      });
      setTimeout(function() {
        convertCardToImage();
      }, 300);
    });

    document.getElementById('downloadButton').onclick = function() {
      var img = document.querySelector('#cardContent img');
      if (img) {
        var a = document.createElement('a');
        a.href = img.src;
        a.download = 'qr_code_card.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    };

    function convertCardToImage() {
      var cardContent = document.getElementById('cardContent');
      html2canvas(cardContent).then(function(canvas) {
        var imgData = canvas.toDataURL('image/png');
        var img = new Image();
        img.src = imgData;
        cardContent.innerHTML = '';
        cardContent.appendChild(img);
        document.getElementById('downloadButton').style.display = 'block';
      });
    }
  </script>
</body>
</html>