<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>‰π¶Á≠æÂç°Áâá</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --main-blue: #4f8cff;
      --main-purple: #a259ff;
      --tab-bg: #d6e4ff;
      --tab-active-bg: #4f8cff;
      --tab-hover-bg: #a259ff;
      --tab-color: #fff;
      --tab-inactive-color: #2563eb;
      --panel-bg: #f0f4ff;
      --card-bg: #e6eaff;
      --card-border: #d0d8f6;
      --ellipse-bg: #fff;
      --ellipse-shadow: 0 2px 8px #b3c6ff33;
    }
    body { font-family: 'Segoe UI', 'PingFang SC', Arial, sans-serif; background: var(--panel-bg); margin: 0; }
    header { background: #fff; padding: 1rem 2rem; border-bottom: 1px solid #eee; font-size: 1.5rem; color: var(--main-blue); display: flex; align-items: center; justify-content: space-between;}
    .settings-btn { background: none; border: none; font-size: 1.6rem; cursor: pointer; color: var(--main-blue); position: fixed; top: 18px; right: 32px; z-index: 1001;}
    main { max-width: 1200px; margin: 2rem auto; background: var(--card-bg); border-radius: 18px; box-shadow: 0 4px 24px #b3c6ff33; padding: 2rem; }
    .group-tabs-wrapper {
      overflow-x: auto;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
    }
    .group-tabs {
      display: flex;
      gap: 0.5rem;
      flex-wrap: nowrap;
      min-width: 600px;
    }
    .group-tab {
      background: var(--tab-bg);
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1.5rem;
      cursor: pointer;
      font-size: 1.08rem;
      color: var(--tab-inactive-color);
      font-weight: 500;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      outline: none;
      white-space: nowrap;
      margin-bottom: 0;
      flex: 0 0 auto;
      box-shadow: 0 2px 8px #b3c6ff22;
      letter-spacing: 1px;
    }
    .group-tab.active, .group-tab:active {
      background: var(--tab-active-bg);
      color: var(--tab-color);
      box-shadow: 0 4px 16px #4f8cff33;
    }
    .group-tab:hover, .group-tab:focus {
      background: var(--tab-hover-bg);
      color: var(--tab-color);
    }
    .group-card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 1rem 0.5rem 1.2rem 0.5rem;
      min-width: 220px;
      box-sizing: border-box;
      margin-bottom: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      box-shadow: 0 2px 8px #b3c6ff22;
    }
    .group-title {
      font-size: 1.08rem;
      font-weight: bold;
      color: var(--main-blue);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding-left: 0.5rem;
    }
    .group-actions button { margin-left: 0.3rem; }
    .bookmark-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 0.7rem 0.7rem;
      margin: 0;
      padding: 0 0.5rem;
      list-style: none;
    }
    .bookmark-item {
      background: var(--ellipse-bg);
      border: 1.5px solid var(--card-border);
      border-radius: 999px / 60px;
      box-shadow: var(--ellipse-shadow);
      padding: 0.35rem 0.7rem 0.35rem 0.5rem;
      display: flex;
      flex-direction: row;
      align-items: center;
      min-width: 0;
      min-height: 48px;
      box-sizing: border-box;
      word-break: normal;
      transition: box-shadow 0.2s, border 0.2s;
      position: relative;
      max-width: 100%;
      justify-content: flex-start;
    }
    .bookmark-item:hover {
      border: 1.5px solid var(--main-purple);
      box-shadow: 0 4px 16px #a259ff33;
    }
    .bookmark-item a {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 100%;
      gap: 0.7rem;
      text-decoration: none;
      min-width: 0;
    }
    .bookmark-favicon {
      width: 28px; height: 28px; border-radius: 50%; background: #f0f4ff; object-fit: cover;
      box-shadow: 0 2px 8px #b3c6ff22;
      display: block;
      flex-shrink: 0;
    }
    .bookmark-title {
      font-weight: 500;
      color: #333;
      font-size: 1.02rem;
      text-align: left;
      max-width: 90%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: block;
      flex: 1 1 auto;
      margin: 0 0 0 0;
      line-height: 1.3;
    }
    .bookmark-actions {
      margin-left: 0.3rem;
      display: flex;
      gap: 0.2rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .bookmark-actions button { font-size: 0.95em; padding: 0.15em 0.7em; }
    .admin-panel { display: none; margin-top: 2rem; }
    .admin-panel.active { display: block; }
    .admin-toolbar { margin-bottom: 1.2rem; display: flex; gap: 1rem; flex-wrap: wrap;}
    .form-row { margin-bottom: 0; }
    input, select { padding: 0.4rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; }
    button { background: var(--main-blue); color: #fff; border: none; border-radius: 4px; padding: 0.3rem 1.1rem; cursor: pointer; font-size: 1rem; }
    button:hover { background: var(--main-purple); }
    .import-export { display: flex; gap: 0.5rem; }
    .modal-bg { display: none; position: fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index: 2000; align-items: center; justify-content: center;}
    .modal-bg.active { display: flex; }
    .modal { background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px #0003; min-width: 260px;}
    .modal input { width: 100%; margin-top: 1rem; }
    @media (max-width: 800px) {
      .bookmark-list { grid-template-columns: repeat(2, 1fr);}
      .bookmark-title { font-size: 0.98rem; max-width: 80%; }
      .bookmark-favicon { width: 22px; height: 22px;}
      .bookmark-item { min-height: 44px; }
    }
    @media (max-width: 500px) {
      .bookmark-list { grid-template-columns: repeat(2, 1fr);}
      .group-tabs { min-width: 0; }
      main { padding: 0.5rem; }
      .bookmark-title { font-size: 0.95rem; max-width: 70%; }
      .bookmark-favicon { width: 18px; height: 18px;}
      .bookmark-item { min-height: 38px; }
    }
  </style>
</head>
<body>
  <header>
    <span>‰π¶Á≠æÂç°Áâá</span>
    <button class="settings-btn" id="settingsBtn" title="ÂêéÂè∞ÁÆ°ÁêÜ/ËøîÂõûÂâçÂè∞"><span>‚öôÔ∏è</span></button>
  </header>
  <main>
    <div class="group-tabs-wrapper">
      <div class="group-tabs" id="groupTabs"></div>
    </div>
    <div class="group-card" id="groupCard"></div>
    <!-- ÂêéÂè∞ÁÆ°ÁêÜÈù¢Êùø -->
    <div class="admin-panel" id="adminPanel">
      <div class="admin-toolbar">
        <form class="form-row" id="catForm" style="display:inline;">
          <input type="text" id="catName" placeholder="Êñ∞ÂàÜÁªÑÂêç" required>
          <button type="submit">Ê∑ªÂä†ÂàÜÁªÑ</button>
        </form>
        <div class="import-export">
          <button type="button" onclick="exportBookmarks()">ÂØºÂá∫‰π¶Á≠æ</button>
          <input type="file" id="importFile" accept=".json" style="display:none" onchange="importBookmarks(event)">
          <button type="button" onclick="document.getElementById('importFile').click()">ÂØºÂÖ•‰π¶Á≠æ</button>
        </div>
      </div>
    </div>
  </main>
  <!-- ÂØÜÁ†ÅÂºπÁ™ó -->
  <div class="modal-bg" id="modalBg">
    <div class="modal">
      <div>ËØ∑ËæìÂÖ•ÂêéÂè∞ÁÆ°ÁêÜÂØÜÁ†ÅÔºö</div>
      <input type="password" id="adminPwd" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
      <button style="margin-top:1rem;width:100%;" onclick="checkPwd()">Á°ÆÂÆö</button>
    </div>
  </div>
  <script>
    function getData() {
      return JSON.parse(localStorage.getItem('bookmarks_data') || '{}');
    }
    function setData(data) {
      localStorage.setItem('bookmarks_data', JSON.stringify(data));
    }

    let data = getData();
    let isAdmin = false;
    let currentCat = Object.keys(data)[0] || '';

    function renderTabs() {
      const groupTabs = document.getElementById('groupTabs');
      groupTabs.innerHTML = '';
      const groupKeys = Object.keys(data);
      if (groupKeys.length === 0) {
        groupTabs.innerHTML = '<div style="color:#888;">ÊöÇÊó†ÂàÜÁªÑÔºåËØ∑Âú®ÂêéÂè∞Ê∑ªÂä†</div>';
        document.getElementById('groupCard').innerHTML = '';
        return;
      }
      groupKeys.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'group-tab' + (cat === currentCat ? ' active' : '');
        btn.textContent = cat;
        btn.onclick = () => { currentCat = cat; renderTabs(); renderGroupCard(); };
        groupTabs.appendChild(btn);
      });
      // Ê®™ÂêëÊªöÂä®Âà∞ÂΩìÂâçÈÄâ‰∏≠
      setTimeout(() => {
        const active = groupTabs.querySelector('.group-tab.active');
        if (active) {
          const wrapper = document.querySelector('.group-tabs-wrapper');
          const left = active.offsetLeft - wrapper.offsetWidth / 2 + active.offsetWidth / 2;
          wrapper.scrollTo({ left, behavior: 'smooth' });
        }
      }, 0);
    }

    function renderGroupCard() {
      const groupCard = document.getElementById('groupCard');
      if (!currentCat || !data[currentCat]) {
        groupCard.innerHTML = '<div style="color:#888;">ËØ∑ÈÄâÊã©ÂàÜÁªÑ</div>';
        return;
      }
      const cat = currentCat;
      let html = '';
      // ÂàÜÁªÑÊ†áÈ¢òÂíåÊìç‰Ωú
      html += `<div class="group-title">`;
      if (isAdmin) {
        html += `<input type="text" id="catTitleInput" value="${cat}" style="font-size:1.1rem;width:7em;">`;
      } else {
        html += cat;
      }
      if (isAdmin) {
        html += `<span class="group-actions">
          <button type="button" onclick="deleteCat('${cat}')">üóëÔ∏è</button>
          <button type="button" onclick="moveCat('${cat}',-1)">‚Üë</button>
          <button type="button" onclick="moveCat('${cat}',1)">‚Üì</button>
        </span>`;
      }
      html += `</div>`;

      // ‰π¶Á≠æÂàóË°®
      html += `<ul class="bookmark-list">`;
      (data[cat] || []).forEach((bm, idx) => {
        html += `<li class="bookmark-item">
          <a href="${bm.url}" target="_blank" title="${bm.name}">
            <img class="bookmark-favicon" src="${bm.favicon || `https://www.google.com/s2/favicons?domain=${bm.url}`}" onerror="this.src='https://www.google.com/s2/favicons?domain=default'">
            <span class="bookmark-title">${bm.name}</span>
          </a>`;
        if (isAdmin) {
          html += `<div class="bookmark-actions">
            <button type="button" onclick="editBookmark('${cat}',${idx})">‚úèÔ∏è</button>
            <button type="button" onclick="deleteBookmark('${cat}',${idx})">üóëÔ∏è</button>
            <button type="button" onclick="moveBookmark('${cat}',${idx},-1)">‚Üë</button>
            <button type="button" onclick="moveBookmark('${cat}',${idx},1)">‚Üì</button>
          </div>`;
        }
        html += `</li>`;
      });
      // ÂêéÂè∞Ê∑ªÂä†‰π¶Á≠æË°®Âçï
      if (isAdmin) {
        html += `<li style="background:none;border:none;box-shadow:none;">
          <form class="form-row" onsubmit="addBookmark(event,'${cat}')">
            <input class="add-name" type="text" placeholder="‰π¶Á≠æÂêç" required style="width:5em;">
            <input class="add-url" type="url" placeholder="https://example.com" required style="width:10em;">
            <input class="add-favicon" type="text" placeholder="Favicon URLÔºàÂèØÈÄâÔºâ" style="width:8em;">
            <button type="submit">Ê∑ªÂä†</button>
          </form>
        </li>`;
      }
      html += `</ul>`;
      groupCard.innerHTML = html;

      // ÂàÜÁªÑÂêçÁºñËæë
      if (isAdmin) {
        document.getElementById('catTitleInput').onchange = function() {
          const newName = this.value.trim();
          if (!newName || data[newName]) { this.value = cat; return; }
          data[newName] = data[cat];
          delete data[cat];
          currentCat = newName;
          setData(data);
          renderTabs();
          renderGroupCard();
        };
      }
    }

    // ÂàÜÁ±ªÊìç‰Ωú
    function deleteCat(cat) {
      if (confirm('Á°ÆÂÆöÂà†Èô§ÂàÜÁªÑÂèäÂÖ∂ÊâÄÊúâ‰π¶Á≠æÔºü')) {
        delete data[cat];
        const keys = Object.keys(data);
        currentCat = keys[0] || '';
        setData(data);
        renderTabs();
        renderGroupCard();
      }
    }
    function moveCat(cat, dir) {
      const keys = Object.keys(data);
      const idx = keys.indexOf(cat);
      if ((dir === -1 && idx === 0) || (dir === 1 && idx === keys.length - 1)) return;
      [keys[idx], keys[idx+dir]] = [keys[idx+dir], keys[idx]];
      const newData = {};
      keys.forEach(k => newData[k] = data[k]);
      data = newData;
      setData(data);
      renderTabs();
      renderGroupCard();
    }

    // ‰π¶Á≠æÊìç‰Ωú
    function editBookmark(cat, idx) {
      const bm = data[cat][idx];
      const name = prompt('‰π¶Á≠æÂêç', bm.name);
      if (!name) return;
      const url = prompt('‰π¶Á≠æURL', bm.url);
      if (!url) return;
      const favicon = prompt('Favicon URL', bm.favicon || '');
      const group = prompt('ÂàÜÁªÑÂêçÔºàÁïôÁ©∫‰∏çÂèòÔºâ', cat);
      let targetCat = group && group !== cat ? group : cat;
      if (!data[targetCat]) data[targetCat] = [];
      const item = { name, url, favicon };
      if (targetCat === cat) {
        data[cat][idx] = item;
      } else {
        data[targetCat].push(item);
        data[cat].splice(idx, 1);
      }
      setData(data);
      renderTabs();
      renderGroupCard();
    }
    function deleteBookmark(cat, idx) {
      if (confirm('Á°ÆÂÆöÂà†Èô§ËØ•‰π¶Á≠æÔºü')) {
        data[cat].splice(idx, 1);
        setData(data);
        renderGroupCard();
      }
    }
    function moveBookmark(cat, idx, dir) {
      const arr = data[cat];
      if ((dir === -1 && idx === 0) || (dir === 1 && idx === arr.length - 1)) return;
      [arr[idx], arr[idx+dir]] = [arr[idx+dir], arr[idx]];
      setData(data);
      renderGroupCard();
    }
    function addBookmark(e, cat) {
      e.preventDefault();
      const form = e.target;
      const name = form.querySelector('.add-name').value.trim();
      const url = form.querySelector('.add-url').value.trim();
      const favicon = form.querySelector('.add-favicon').value.trim();
      if (!name || !url) return;
      data[cat].push({ name, url, favicon });
      setData(data);
      form.reset();
      renderGroupCard();
    }

    // Ê∑ªÂä†ÂàÜÁªÑ
    document.getElementById('catForm').onsubmit = e => {
      e.preventDefault();
      const name = document.getElementById('catName').value.trim();
      if (!name || data[name]) return;
      data[name] = [];
      currentCat = name;
      setData(data);
      document.getElementById('catName').value = '';
      renderTabs();
      renderGroupCard();
    };

    // ÂØºÂá∫
    function exportBookmarks() {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'bookmarks.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ÂØºÂÖ•
    function importBookmarks(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => {
        try {
          const json = JSON.parse(evt.target.result);
          if (typeof json !== 'object') throw new Error('Ê†ºÂºèÈîôËØØ');
          data = json;
          currentCat = Object.keys(data)[0] || '';
          setData(data);
          renderTabs();
          renderGroupCard();
        } catch (err) {
          alert('ÂØºÂÖ•Â§±Ë¥•Ôºö' + err.message);
        }
      };
      reader.readAsText(file);
    }

    // ÂêéÂè∞ÂÖ•Âè£/ÂàáÊç¢
    document.getElementById('settingsBtn').onclick = function() {
      if (!isAdmin) {
        document.getElementById('modalBg').classList.add('active');
        document.getElementById('adminPwd').value = '';
        setTimeout(()=>{document.getElementById('adminPwd').focus();}, 100);
      } else {
        isAdmin = false;
        document.getElementById('adminPanel').classList.remove('active');
        renderTabs();
        renderGroupCard();
      }
    };
    function checkPwd() {
      const pwd = document.getElementById('adminPwd').value;
      if (pwd === 'baoge888') {
        isAdmin = true;
        document.getElementById('adminPanel').classList.add('active');
        document.getElementById('modalBg').classList.remove('active');
        renderTabs();
        renderGroupCard();
      } else {
        alert('ÂØÜÁ†ÅÈîôËØØ');
      }
    }
    document.getElementById('adminPwd').addEventListener('keydown', function(e){
      if(e.key === 'Enter') checkPwd();
    });
    document.getElementById('modalBg').onclick = function(e){
      if(e.target === this) this.classList.remove('active');
    };

    renderTabs();
    renderGroupCard();
  </script>
</body>
</html>