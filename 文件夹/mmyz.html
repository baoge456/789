<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>安全书签系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background: #f0f2f5; font-family: '微软雅黑', Arial, sans-serif; }
    .container { max-width: 400px; margin: 60px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #eee; padding: 32px 24px; }
    h2 { text-align: center; margin-bottom: 32px; }
    .bookmark-list { margin-bottom: 32px; }
    .bookmark-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
    .bookmark-item:last-child { border-bottom: none; }
    .btn { padding: 4px 16px; border: none; border-radius: 4px; background: #1677ff; color: #fff; cursor: pointer; }
    .btn.danger { background: #e74c3c; }
    .btn.gray { background: #888; }
    .btn + .btn { margin-left: 8px; }
    .input { padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; }
    .admin-link { text-align: center; margin-top: 24px; }
    .hidden { display: none; }
    .error { color: #e74c3c; text-align: center; margin-bottom: 12px; }
    .success { color: #27ae60; text-align: center; margin-bottom: 12px; }
    .form-row { margin-bottom: 12px; }
    label { display: block; margin-bottom: 4px; }
  </style>
</head>
<body>
  <div class="container" id="main-view">
    <h2>安全书签</h2>
    <div class="bookmark-list" id="bookmark-list"></div>
    <div class="admin-link">
      <button class="btn gray" onclick="showPasswordModal('admin')">进入后台管理</button>
    </div>
  </div>

  <!-- 密码弹窗 -->
  <div class="container hidden" id="password-modal">
    <h2 id="pwd-title">请输入密码</h2>
    <div id="pwd-error" class="error"></div>
    <input class="input" type="password" id="pwd-input" placeholder="密码" autofocus>
    <div style="text-align:center;margin-top:16px;">
      <button class="btn" onclick="checkPassword()">确定</button>
      <button class="btn gray" onclick="hidePasswordModal()">取消</button>
    </div>
  </div>

  <!-- 后台管理 -->
  <div class="container hidden" id="admin-view">
    <h2>书签管理</h2>
    <div id="admin-success" class="success"></div>
    <div class="bookmark-list" id="admin-bookmark-list"></div>
    <form id="add-form" onsubmit="addBookmark(event)">
      <div class="form-row">
        <label>书签名</label>
        <input class="input" type="text" id="add-name" required>
      </div>
      <div class="form-row">
        <label>网址</label>
        <input class="input" type="url" id="add-url" required placeholder="https://...">
      </div>
      <div class="form-row">
        <label>书签打开密码</label>
        <input class="input" type="password" id="add-bmpwd" required minlength="2">
      </div>
      <button class="btn" type="submit">添加书签</button>
    </form>
    <hr style="margin:24px 0;">
    <div style="margin-bottom:16px;font-weight:bold;">修改书签密码</div>
    <form id="bm-pwd-form" onsubmit="changeBookmarkPwd(event)">
      <div class="form-row">
        <label>选择书签</label>
        <select class="input" id="bm-select" required></select>
      </div>
      <div class="form-row">
        <label>新密码</label>
        <input class="input" type="password" id="bm-new-pwd" required minlength="2">
      </div>
      <button class="btn" type="submit">修改密码</button>
    </form>
    <div class="admin-link">
      <button class="btn gray" onclick="exitAdmin()">返回书签页</button>
    </div>
  </div>

  <script>
    // 本地存储
    function getLocal(key, def) {
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : def; } catch { return def; }
    }
    function setLocal(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

    // 后台密码
    let adminPassword = getLocal('bookmark_admin_pwd', 'baoge888');
    // 书签结构: {name, url, pwd}
    let bookmarks = getLocal('bookmarks', []);

    // 视图切换
    function showView(id) {
      document.getElementById('main-view').classList.add('hidden');
      document.getElementById('password-modal').classList.add('hidden');
      document.getElementById('admin-view').classList.add('hidden');
      document.getElementById(id).classList.remove('hidden');
    }

    // 书签页渲染
    function renderBookmarks() {
      const list = document.getElementById('bookmark-list');
      if (!bookmarks.length) {
        list.innerHTML = '<div style="text-align:center;color:#888;">暂无书签</div>';
        return;
      }
      list.innerHTML = bookmarks.map((b, i) =>
        `<div class="bookmark-item">
          <span>${b.name}</span>
          <button class="btn" onclick="showPasswordModal('open',${i})">打开</button>
        </div>`
      ).join('');
    }

    // 密码弹窗
    let pwdAction = null, pwdIndex = null;
    function showPasswordModal(action, idx) {
      pwdAction = action; pwdIndex = idx;
      document.getElementById('pwd-input').value = '';
      document.getElementById('pwd-error').textContent = '';
      document.getElementById('pwd-title').textContent = (action === 'admin') ? '请输入后台密码' : '请输入书签密码';
      showView('password-modal');
      setTimeout(() => {
        const input = document.getElementById('pwd-input');
        input.focus();
        // 支持回车直接确认
        input.onkeydown = function(e) {
          if (e.key === 'Enter') checkPassword();
        };
      }, 100);
    }
    function hidePasswordModal() {
      showView('main-view');
    }
    function checkPassword() {
      const input = document.getElementById('pwd-input').value;
      if (pwdAction === 'admin') {
        if (input !== adminPassword) {
          document.getElementById('pwd-error').textContent = '后台密码错误';
          return;
        }
        renderAdminBookmarks();
        renderBookmarkSelect();
        showView('admin-view');
      } else if (pwdAction === 'open') {
        if (input !== bookmarks[pwdIndex].pwd) {
          document.getElementById('pwd-error').textContent = '书签密码错误';
          return;
        }
        window.open(bookmarks[pwdIndex].url, '_blank');
        showView('main-view');
      }
    }

    // 后台管理
    function renderAdminBookmarks() {
      const list = document.getElementById('admin-bookmark-list');
      if (!bookmarks.length) {
        list.innerHTML = '<div style="text-align:center;color:#888;">暂无书签</div>';
        return;
      }
      list.innerHTML = bookmarks.map((b, i) =>
        `<div class="bookmark-item">
          <span>${b.name} - <a href="${b.url}" target="_blank">${b.url}</a></span>
          <button class="btn danger" onclick="deleteBookmark(${i})">删除</button>
        </div>`
      ).join('');
    }
    function addBookmark(e) {
      e.preventDefault();
      const name = document.getElementById('add-name').value.trim();
      const url = document.getElementById('add-url').value.trim();
      const pwd = document.getElementById('add-bmpwd').value.trim();
      if (!name || !url || !pwd) return;
      bookmarks.push({ name, url, pwd });
      setLocal('bookmarks', bookmarks);
      renderAdminBookmarks();
      renderBookmarkSelect();
      document.getElementById('add-form').reset();
      showSuccess('添加成功');
      renderBookmarks();
    }
    function deleteBookmark(idx) {
      if (!confirm('确定删除该书签？')) return;
      bookmarks.splice(idx, 1);
      setLocal('bookmarks', bookmarks);
      renderAdminBookmarks();
      renderBookmarkSelect();
      renderBookmarks();
      showSuccess('删除成功');
    }
    function renderBookmarkSelect() {
      const sel = document.getElementById('bm-select');
      sel.innerHTML = bookmarks.map((b, i) =>
        `<option value="${i}">${b.name}</option>`
      ).join('');
    }
    function changeBookmarkPwd(e) {
      e.preventDefault();
      const idx = document.getElementById('bm-select').value;
      const newPwd = document.getElementById('bm-new-pwd').value.trim();
      if (idx === '' || !newPwd) return;
      bookmarks[idx].pwd = newPwd;
      setLocal('bookmarks', bookmarks);
      document.getElementById('bm-pwd-form').reset();
      showSuccess('书签密码已修改');
    }
    function showSuccess(msg) {
      const el = document.getElementById('admin-success');
      el.textContent = msg;
      setTimeout(() => { el.textContent = ''; }, 1500);
    }
    function exitAdmin() {
      renderBookmarks();
      showView('main-view');
    }

    // 初始化
    renderBookmarks();
    showView('main-view');
  </script>
</body>
</html>